<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ã–±–æ—Ä –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            padding-bottom: 80px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--tg-theme-hint-color, #ccc);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            padding: 16px;
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--tg-theme-button-color, #3390ec);
        }

        .stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
            margin-top: 4px;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .quick-btn {
            flex: 1;
            padding: 10px;
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            color: var(--tg-theme-text-color, #000000);
        }

        .quick-btn:active {
            opacity: 0.7;
        }

        .search-box {
            position: sticky;
            top: 0;
            background: var(--tg-theme-bg-color, #ffffff);
            padding: 8px 0;
            margin-bottom: 16px;
            z-index: 10;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 12px;
            font-size: 15px;
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000000);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .category {
            margin-bottom: 24px;
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-badge {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .category-coins {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .coin-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .coin-item:active {
            transform: scale(0.98);
        }

        .coin-item.selected {
            background: var(--tg-theme-button-color, #3390ec);
            border-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .coin-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 6px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .coin-item.selected .coin-checkbox {
            background: var(--tg-theme-button-text-color, #ffffff);
            border-color: var(--tg-theme-button-text-color, #ffffff);
        }

        .coin-checkbox::after {
            content: '‚úì';
            font-size: 16px;
            font-weight: 700;
            color: var(--tg-theme-button-color, #3390ec);
            display: none;
        }

        .coin-item.selected .coin-checkbox::after {
            display: block;
        }

        .coin-info {
            flex: 1;
        }

        .coin-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .coin-symbol {
            font-size: 13px;
            opacity: 0.7;
        }

        .coin-item.selected .coin-symbol {
            opacity: 0.9;
        }

        .coin-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-bip39 {
            background: #34c759;
            color: white;
        }

        .badge-ton {
            background: #0098ea;
            color: white;
        }

        .badge-electrum {
            background: #ff9500;
            color: white;
        }

        .coin-item.selected .coin-badge {
            opacity: 0.9;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü™ô –í—ã–±–æ—Ä –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</h1>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–Ω–µ—Ç—ã –¥–ª—è –¥–µ—Ä–∏–≤–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤</p>
    </div>

    <div class="stats">
        <div class="stat-item">
            <div class="stat-value" id="selectedCount">0</div>
            <div class="stat-label">–í—ã–±—Ä–∞–Ω–æ</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="totalCount">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ</div>
        </div>
    </div>

    <div class="quick-actions">
        <button class="quick-btn" onclick="selectCategory('popular')">‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</button>
        <button class="quick-btn" onclick="selectAll()">‚òëÔ∏è –í—Å–µ</button>
        <button class="quick-btn" onclick="deselectAll()">‚¨ú –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <div class="search-box">
        <input 
            type="text" 
            class="search-input" 
            id="searchInput" 
            placeholder="üîç –ü–æ–∏—Å–∫ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã..."
            oninput="filterCoins()"
        >
    </div>

    <div id="coinsContainer"></div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText('–ù–∞—á–∞—Ç—å –¥–µ—Ä–∏–≤–∞—Ü–∏—é');
        tg.MainButton.show();

        // –ë–∞–∑–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç —Å –¥–µ—Ä–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
        const coinsDatabase = {
            popular: [
                { id: 'btc', name: 'Bitcoin', symbol: 'BTC', type: 'BIP39', path: "m/44'/0'/0'/0", icon: '‚Çø' },
                { id: 'eth', name: 'Ethereum', symbol: 'ETH', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'Œû' },
                { id: 'usdt_erc20', name: 'Tether (ERC-20)', symbol: 'USDT', type: 'BIP39', path: "m/44'/60'/0'/0", icon: '‚ÇÆ' },
                { id: 'bnb', name: 'BNB Chain', symbol: 'BNB', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üî∂' },
                { id: 'ton', name: 'TON', symbol: 'TON', type: 'TON', path: null, icon: 'üíé' },
                { id: 'trx', name: 'Tron', symbol: 'TRX', type: 'BIP39', path: "m/44'/195'/0'/0", icon: '‚ö°' },
            ],
            bitcoin: [
                { id: 'btc', name: 'Bitcoin', symbol: 'BTC', type: 'BIP39', path: "m/44'/0'/0'/0", icon: '‚Çø' },
                { id: 'btc_segwit', name: 'Bitcoin SegWit', symbol: 'BTC', type: 'BIP39', path: "m/49'/0'/0'/0", icon: '‚Çø' },
                { id: 'btc_native', name: 'Bitcoin Native SegWit', symbol: 'BTC', type: 'BIP39', path: "m/84'/0'/0'/0", icon: '‚Çø' },
                { id: 'ltc', name: 'Litecoin', symbol: 'LTC', type: 'BIP39', path: "m/44'/2'/0'/0", icon: '≈Å' },
                { id: 'bch', name: 'Bitcoin Cash', symbol: 'BCH', type: 'BIP39', path: "m/44'/145'/0'/0", icon: 'üíö' },
                { id: 'doge', name: 'Dogecoin', symbol: 'DOGE', type: 'BIP39', path: "m/44'/3'/0'/0", icon: 'üêï' },
                { id: 'dash', name: 'Dash', symbol: 'DASH', type: 'BIP39', path: "m/44'/5'/0'/0", icon: 'üí≥' },
            ],
            ethereum: [
                { id: 'eth', name: 'Ethereum', symbol: 'ETH', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'Œû' },
                { id: 'usdt_erc20', name: 'Tether (ERC-20)', symbol: 'USDT', type: 'BIP39', path: "m/44'/60'/0'/0", icon: '‚ÇÆ' },
                { id: 'usdc_erc20', name: 'USD Coin (ERC-20)', symbol: 'USDC', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üíµ' },
                { id: 'bnb', name: 'BNB Chain', symbol: 'BNB', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üî∂' },
                { id: 'matic', name: 'Polygon', symbol: 'MATIC', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üü£' },
                { id: 'avax', name: 'Avalanche C-Chain', symbol: 'AVAX', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üî∫' },
                { id: 'ftm', name: 'Fantom', symbol: 'FTM', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üëª' },
                { id: 'arb', name: 'Arbitrum', symbol: 'ARB', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üî∑' },
                { id: 'op', name: 'Optimism', symbol: 'OP', type: 'BIP39', path: "m/44'/60'/0'/0", icon: 'üî¥' },
            ],
            altcoins: [
                { id: 'trx', name: 'Tron', symbol: 'TRX', type: 'BIP39', path: "m/44'/195'/0'/0", icon: '‚ö°' },
                { id: 'usdt_trc20', name: 'Tether (TRC-20)', symbol: 'USDT', type: 'BIP39', path: "m/44'/195'/0'/0", icon: '‚ÇÆ' },
                { id: 'ada', name: 'Cardano', symbol: 'ADA', type: 'BIP39', path: "m/1852'/1815'/0'/0/0", icon: 'üîµ' },
                { id: 'xrp', name: 'Ripple', symbol: 'XRP', type: 'BIP39', path: "m/44'/144'/0'/0", icon: 'üíß' },
                { id: 'xlm', name: 'Stellar', symbol: 'XLM', type: 'BIP39', path: "m/44'/148'/0'/0", icon: '‚≠ê' },
                { id: 'sol', name: 'Solana', symbol: 'SOL', type: 'BIP39', path: "m/44'/501'/0'/0", icon: '‚óé' },
                { id: 'atom', name: 'Cosmos', symbol: 'ATOM', type: 'BIP39', path: "m/44'/118'/0'/0", icon: '‚öõÔ∏è' },
                { id: 'dot', name: 'Polkadot', symbol: 'DOT', type: 'BIP39', path: "m/44'/354'/0'/0", icon: 'üî¥' },
                { id: 'near', name: 'NEAR Protocol', symbol: 'NEAR', type: 'BIP39', path: "m/44'/397'/0'/0", icon: '‚ìÉ' },
            ],
            other: [
                { id: 'ton', name: 'TON', symbol: 'TON', type: 'TON', path: null, icon: 'üíé' },
                { id: 'etc', name: 'Ethereum Classic', symbol: 'ETC', type: 'BIP39', path: "m/44'/61'/0'/0", icon: 'üå±' },
                { id: 'zec', name: 'Zcash', symbol: 'ZEC', type: 'BIP39', path: "m/44'/133'/0'/0", icon: 'üõ°Ô∏è' },
                { id: 'xmr', name: 'Monero', symbol: 'XMR', type: 'ELECTRUM', path: null, icon: 'üîí' },
                { id: 'eos', name: 'EOS', symbol: 'EOS', type: 'BIP39', path: "m/44'/194'/0'/0", icon: 'üì°' },
                { id: 'waves', name: 'Waves', symbol: 'WAVES', type: 'BIP39', path: "m/44'/5741564'/0'/0", icon: 'üåä' },
            ]
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç
        let selectedCoins = new Set();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∏–∑ –ë–î (–ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –±–æ—Ç–æ–º)
            loadActiveCoinsFromBot();
            renderCoins();
            updateStats();
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∏–∑ –±–æ—Ç–∞
        function loadActiveCoinsFromBot() {
            // Telegram WebApp –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ initDataUnsafe
            const initData = tg.initDataUnsafe;
            
            if (initData && initData.start_param) {
                try {
                    // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (–∞–¥–º–∏–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç)
                    const activeCoinsData = JSON.parse(atob(initData.start_param));
                    
                    if (activeCoinsData && activeCoinsData.active_coins) {
                        // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
                        const activeCoinIds = activeCoinsData.active_coins;
                        
                        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–æ–Ω–µ—Ç
                        Object.keys(coinsDatabase).forEach(category => {
                            coinsDatabase[category] = coinsDatabase[category].filter(coin => 
                                activeCoinIds.includes(coin.id)
                            );
                        });
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç:', e);
                }
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–æ–Ω–µ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        function renderCoins() {
            const container = document.getElementById('coinsContainer');
            container.innerHTML = '';

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
            const allCoins = {};
            Object.values(coinsDatabase).flat().forEach(coin => {
                if (!allCoins[coin.id]) {
                    allCoins[coin.id] = coin;
                }
            });

            document.getElementById('totalCount').textContent = Object.keys(allCoins).length;

            // –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            Object.entries(coinsDatabase).forEach(([categoryKey, coins]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.dataset.category = categoryKey;

                const categoryName = {
                    popular: '‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ',
                    bitcoin: '‚Çø Bitcoin-–ø–æ–¥–æ–±–Ω—ã–µ',
                    ethereum: 'Œû EVM-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ',
                    altcoins: 'üåê –ê–ª—å—Ç–∫–æ–∏–Ω—ã',
                    other: 'üîß –î—Ä—É–≥–∏–µ'
                }[categoryKey];

                categoryDiv.innerHTML = `
                    <div class="category-header" onclick="toggleCategory('${categoryKey}')">
                        <div class="category-title">
                            ${categoryName}
                            <span class="category-badge">${coins.length}</span>
                        </div>
                    </div>
                    <div class="category-coins" id="category-${categoryKey}">
                        ${coins.map(coin => renderCoin(coin)).join('')}
                    </div>
                `;

                container.appendChild(categoryDiv);
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–¥–Ω–æ–π –º–æ–Ω–µ—Ç—ã
        function renderCoin(coin) {
            const isSelected = selectedCoins.has(coin.id);
            const badgeClass = coin.type === 'BIP39' ? 'badge-bip39' : coin.type === 'TON' ? 'badge-ton' : 'badge-electrum';
            
            return `
                <div 
                    class="coin-item ${isSelected ? 'selected' : ''}" 
                    data-coin-id="${coin.id}"
                    data-coin-name="${coin.name}"
                    data-coin-symbol="${coin.symbol}"
                    onclick="toggleCoin('${coin.id}')"
                >
                    <div class="coin-checkbox"></div>
                    <div class="coin-info">
                        <div class="coin-name">${coin.icon} ${coin.name}</div>
                        <div class="coin-symbol">${coin.symbol}${coin.path ? ` ‚Ä¢ ${coin.path}` : ''}</div>
                    </div>
                    <span class="coin-badge ${badgeClass}">${coin.type}</span>
                </div>
            `;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã
        function toggleCoin(coinId) {
            if (selectedCoins.has(coinId)) {
                selectedCoins.delete(coinId);
            } else {
                selectedCoins.add(coinId);
            }
            
            const coinElement = document.querySelector(`[data-coin-id="${coinId}"]`);
            coinElement.classList.toggle('selected');
            
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('selectedCount').textContent = selectedCoins.size;
            
            // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É
            if (selectedCoins.size > 0) {
                tg.MainButton.setText(`–ù–∞—á–∞—Ç—å –¥–µ—Ä–∏–≤–∞—Ü–∏—é (${selectedCoins.size})`);
                tg.MainButton.enable();
            } else {
                tg.MainButton.setText('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–æ–Ω–µ—Ç—É');
                tg.MainButton.disable();
            }
        }

        // –í—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        function selectCategory(category) {
            selectedCoins.clear();
            coinsDatabase[category].forEach(coin => {
                selectedCoins.add(coin.id);
            });
            renderCoins();
            updateStats();
        }

        // –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
        function selectAll() {
            selectedCoins.clear();
            Object.values(coinsDatabase).flat().forEach(coin => {
                selectedCoins.add(coin.id);
            });
            renderCoins();
            updateStats();
        }

        // –°–Ω—è—Ç—å –≤—ã–±–æ—Ä
        function deselectAll() {
            selectedCoins.clear();
            renderCoins();
            updateStats();
        }

        // –ü–æ–∏—Å–∫
        function filterCoins() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            document.querySelectorAll('.coin-item').forEach(item => {
                const name = item.dataset.coinName.toLowerCase();
                const symbol = item.dataset.coinSymbol.toLowerCase();
                
                if (name.includes(query) || symbol.includes(query)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        }

        // –°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        function toggleCategory(categoryKey) {
            const categoryCoins = document.getElementById(`category-${categoryKey}`);
            categoryCoins.classList.toggle('hidden');
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        tg.MainButton.onClick(function() {
            if (selectedCoins.size === 0) {
                return;
            }

            // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç
            const selectedCoinsData = [];
            Object.values(coinsDatabase).flat().forEach(coin => {
                if (selectedCoins.has(coin.id)) {
                    selectedCoinsData.push(coin);
                }
            });

            // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            tg.sendData(JSON.stringify({
                coins: selectedCoinsData
            }));
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ WebApp
        tg.BackButton.show();
        tg.BackButton.onClick(function() {
            tg.close();
        });

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>
